// Copyright 2023 The go-ethereum Authors
// This file is part of the go-ethereum library.
//
// The go-ethereum library is free software: you can redistribute it and/or modify
// it under the terms of the GNU Lesser General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// The go-ethereum library is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
// GNU Lesser General Public License for more details.
//
// You should have received a copy of the GNU Lesser General Public License
// along with the go-ethereum library. If not, see <http://www.gnu.org/licenses/>.

package qrlapi

import (
	"context"
	"encoding/json"
	"errors"
	"fmt"
	"math/big"
	"os"
	"path/filepath"
	"reflect"
	"slices"
	"testing"
	"time"

	"github.com/stretchr/testify/require"
	walletmldsa87 "github.com/theQRL/go-qrllib/wallet/ml_dsa_87"
	qrl "github.com/theQRL/go-zond"
	"github.com/theQRL/go-zond/accounts"
	"github.com/theQRL/go-zond/common"
	"github.com/theQRL/go-zond/common/hexutil"
	"github.com/theQRL/go-zond/consensus"
	"github.com/theQRL/go-zond/consensus/beacon"
	"github.com/theQRL/go-zond/core"
	"github.com/theQRL/go-zond/core/bloombits"
	"github.com/theQRL/go-zond/core/rawdb"
	"github.com/theQRL/go-zond/core/state"
	"github.com/theQRL/go-zond/core/types"
	"github.com/theQRL/go-zond/core/vm"
	"github.com/theQRL/go-zond/crypto"
	"github.com/theQRL/go-zond/crypto/pqcrypto"
	"github.com/theQRL/go-zond/event"
	"github.com/theQRL/go-zond/internal/blocktest"
	"github.com/theQRL/go-zond/params"
	"github.com/theQRL/go-zond/qrldb"
	"github.com/theQRL/go-zond/rpc"
)

func testTransactionMarshal(t *testing.T, tests []txData, config *params.ChainConfig) {
	t.Parallel()
	var (
		signer = types.LatestSigner(config)
		key, _ = pqcrypto.HexToWallet("b71c71a67e1177ad4e901695e1b4b9ee17ae16c6668d313eac2f96dbcda3f291")
	)

	for i, tt := range tests {
		var tx2 types.Transaction
		tx, err := types.SignNewTx(key, signer, tt.Tx)
		if err != nil {
			t.Fatalf("test %d: signing failed: %v", i, err)
		}
		// Regular transaction
		if data, err := json.Marshal(tx); err != nil {
			t.Fatalf("test %d: marshalling failed; %v", i, err)
		} else if err = tx2.UnmarshalJSON(data); err != nil {
			t.Fatalf("test %d: sunmarshal failed: %v", i, err)
		} else if want, have := tx.Hash(), tx2.Hash(); want != have {
			t.Fatalf("test %d: stx changed, want %x have %x", i, want, have)
		}

		// rpcTransaction
		rpcTx := newRPCTransaction(tx, common.Hash{}, 0, 0, nil, config)
		if data, err := json.Marshal(rpcTx); err != nil {
			t.Fatalf("test %d: marshalling failed; %v", i, err)
		} else if err = tx2.UnmarshalJSON(data); err != nil {
			t.Fatalf("test %d: unmarshal failed: %v", i, err)
		} else if want, have := tx.Hash(), tx2.Hash(); want != have {
			t.Fatalf("test %d: tx changed, want %x have %x", i, want, have)
		} else {
			want, have := tt.Want, string(data)
			require.JSONEqf(t, want, have, "test %d: rpc json not match, want %s have %s", i, want, have)
		}
	}
}

func TestTransaction_RoundTripRpcJSON(t *testing.T) {
	var (
		config = params.AllBeaconProtocolChanges
		tests  = allTransactionTypes(common.Address{0xde, 0xad}, config)
	)
	testTransactionMarshal(t, tests, config)
}

type txData struct {
	Tx   types.TxData
	Want string
}

func allTransactionTypes(addr common.Address, config *params.ChainConfig) []txData {
	return []txData{
		{
			Tx: &types.DynamicFeeTx{
				ChainID:   config.ChainID,
				Nonce:     5,
				GasTipCap: big.NewInt(6),
				GasFeeCap: big.NewInt(9),
				Gas:       7,
				To:        &addr,
				Value:     big.NewInt(8),
				Data:      []byte{0, 1, 2, 3, 4},
				AccessList: types.AccessList{
					types.AccessTuple{
						Address:     common.Address{0x2},
						StorageKeys: []common.Hash{types.EmptyRootHash},
					},
				},
				Signature:  []byte{},
				PublicKey:  []byte{},
				Descriptor: []byte{},
			},
			Want: `{
				"blockHash": null,
				"blockNumber": null,
				"from": "Qdf45784bb8fb8c5f31cb3e27cb8fa3b40d855618",
				"gas": "0x7",
				"gasPrice": "0x9",
				"maxFeePerGas": "0x9",
				"maxPriorityFeePerGas": "0x6",
				"hash": "0x1c783ada5ccd9229bd22acaa74a59b6987b308da7aaa890f74a36d3ec126ca91",
				"input": "0x0001020304",
				"nonce": "0x5",
				"to": "Qdead000000000000000000000000000000000000",
				"transactionIndex": null,
				"value": "0x8",
				"type": "0x2",
				"accessList": [
					{
						"address": "Q0200000000000000000000000000000000000000",
						"storageKeys": [
							"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421"
						]
					}
				],
				"chainId": "0x539",
				"signature": "0x0655d08b4889fef61591e2be5431ab2d9947eae177e3f49cc495b57aa7f20d60fc03cf41c4b36bf27bebb30f4b65fb951657ef67a52eb14d9132fadc39cce21df940720125402d00709a5fbf107666d05650764cba1a5c9d8020d538c39772d62e328aaa583539d33421d26908b18eab3de952cf719cf135cdc4fd584c8d99389b23cfefaac669b43c214ef67ae5a766931382f53f917b30ee917e223e6be8d646c20fbf547ed5256edd1c8ca1e586ed3adb68e7e2b4df2a28be036b8e39064c0ba62a768ce8d227d2dfd1344c38289bd776d3632599994f252e74796ce5e959f4e996cace8494c92f498b99a5fbb6f6f67f639ce5f934b77bd68b82253daadeaa7045c829c803989e21157c335807d28e61e93a66f7489d5803ac17c93122c5e717aaab3b7820b480af400d6e30c35a0e3697ec408a193f35ea991cb4c33dd070a7adbb6880b76d6f596b48b6d490bec581a06e9a8b52ae627431a04b433fdd448828dcb99bbbbce00609d964c358d42796122e0380eea412aed8375c4d06e68c20d415447c46eb9d9bc84e76815623df71777e22c45fc5eb6254efa7c36c9001df462e17a6fb0d847080e38a4603e57fdd3d7bdd6cd049f059a4e564980a6da45fa4ab744f3c656f1e22d147532dc9ac1fa48d9110ef627e6f1ff423e18d502e5bb0fe22e8e4a31ae45f240d265537cf870ee671ab7ab23705ea2482cd43186cf37fe2f3926e7c555995b7ab3afe4143f3562d99a65828576bf1b11fd06194d99d7075b164bfb4c424e2a05da902695b67a390d994975df216ab624c173854e854bc028d5b215fc2001a8d1b3ff53278dda37799d667cbd7bd3b158f14fb91d636988f7a069bfc5f2dfb94f110fdba8bfd642d5db4109bcccdeeb9b2aa0b9c4cf1a1f8b131ff15c2366a6849365a1877968ddd3d2e57ea7563cc7a6b057a61225d300761fb0e44add6270c11f9b404b8a31d5d42e345eb6727ec98e1382bb6869ec44b0626a14d01e404a211b31ac60c6c48d422c387ad106fb9751d43b7c4935e5a43f3d9c0b49ee86993b1e443bcf2e29822253c1f549f37f68a858debb8f5d3db3bb471f4fda63d1c73e8a605544cc7dd4e70ffcc5b7ef1c962f321170a997b3553f8f426407e5df294f0ab4b89d890ebc3c322b9a8c36996573d74af49a95d800ca8063fc99d27312daecde7a657497c8b410261e2d45287e75bff1e22d96a21f3314959ef698f4c67e25c87ceabd7ee8d0dfb489cef8e81d679c0504e05a673fd2e83f95527ace4e4fbbee28c704f64a136985f10ef23e52f409a4845efffad8c7a537dfa62760d9551d66a3950c75de6d3286495593d7e3eb101349087df6a268d51aeedcc17d9a7827b1c2f96a23a007e2a5f14665800a88bd26df97cb62ccf69a357557a7f21507f26c9a95fde175cdbc7593433f326a445415fe6294ab92a99bcbc26d3e5c5628ce2b9219f3d77d4e7f0b30a4bbd4bb5032ffe0df83efa96bf02cb71fe43067f5189679676f20f262ae467c04c90da49c152677af211c50d40113e128819fbef974a223f65b49e64355dc3a4ba84983cc316d0f4b87d2f7a7a3715271b62ae2089e21b494fee685a4d11dfa662b4909c0606d177373741c800dd311e9910453e7c93e286945d4b66c8ae00aaac2ca8ba5ea0ddd5b3fb522a490a3b3ff8782338238f5345f70b033587a08c3a125ab6e987870edb36a0b5a83beb22ba967d20e481d56c0370395f490de18c84aa319cbea1abc5ce361d404c6965dbc3fa3c681fba8b8f17848996cdb107d38f65274f54ac21c9ee5cf667f3d2035eda430005f1424074318d60e01d4fead4736ea5f813198c3b9de70afdf815bd6fdc71fc33101947666649a0ecff1a58ff0e1e4868a2e39f8203760c1a9a2acdbff5b98446c0adc85a7ad18f9705f599aa319283d36e2c51d9a87ad3950ebb80667744ab2f95b186f207c1df37685e0dd0f7445620a48ba455263f0510eae8a72665253f6df83efab492d18135019aebf962a0677defe10d49e04b8dfffe16fafc54ecfe64819da2a67ba11283c96988ab85580d58ad35663f06927686c9976da76ade24d37a5bf6c0fd086d9d8d2ae1b293836c035229a16ea39183f700fe16db018bf56c9b8570c7f9d4e0df5623cbb3f091785e665d2e355262d820a0acd6e3ee01690ed618d2812124ce0fb3400ed6e6345fec6662b48a89b4b26409f0adbc48dae594cd4ccc1425807f096aa305c8c40115352efcd0a2c2f2cc2522b4abd2344576fc05f2096d50bab3fd598384524270f869094c954f832e3b03d5fe6bd146115dc6c944f1332a5f6ba60888d5b5e3bcb78468aa61c7e043b8477a8f31a83e7a92cdea32b5093e979cb51fea9df3538929f60e96565125725aec20a68d60e7895869e8d41656730efd9093da8b890837efa3b661844013f49dbaa22138a5ef5cdf3b0f192a3b4206ff27cd6f4c8cc2a8f1a747cc5ae60c56cea83f73adead8133393a9785b515dd49281620c068bdd6d954ec138c45baa1d149fbd5daccb342b7d06efb4502b4d760aa107ea3cc9bee602c47177bb2776fe776f3594e23379ee27ba461b8c6b619e91f6cf4c74915b1ae6ce402099c92f52ec255b493647b245cfc808b8499140f6547d643d6dd8b58985ac8c2e2c4ea6dfea5c197bbaf5c719a0902ec7d7deeafd0f1069c2fe5bf9d16a6f2e45001efcd07f568c147a835aca3578c49ace14d644120c4d0c1817946fd63bbc231331e7fd57c414ba39fc23deb7d5731ffeb86b1cb07d5cfcfa57f29a5aebf383d33464ddd1da485410f3438009a7f0d727aa5e56d8ce185db57c2da51abe755fdade396800b00e238e0c296a8b99b888d9db086919db12c4577c34417b42f803d4c03ab83133b03d20c22b1c609025bc5e60ddef7c8edda7fafded40e08e73cbab9332482f3ff87bf01e7aafe531223d4aef6863f98f6251ec439769e9389bc5f3d265aead9527c878f3a087ba7c0760493eb30c8cfa8c152955d0b04de182a7e3bd6e8c3ffd71a342a04a24fc234be1b5e584c99e5d41cbd448e0049911664b93a9e6ce995a01cce82993e16770e2444b942cd63c26ac4790eed3dfe558f407292873f295e8cbf63fce40bb78e867ff5f6a76c844f9e389a1743b455d04d3e85234751ed0401ccd9889790923ba48ab67004076e5a05cfe869504b51d1bd5c7438840e776d0c64a86bed655809a7032acb24039e243f88474ffcd2e945ed649682d544c8150e820ce667ca5042c20fd47ec9f2242a9099d134ab03a97a7d912ae478abd14ce76d6fba77bf3cd7cc5bd4ac43889f56bb750fc12c3e4e32cd42ff08d1f5fb22d643139183ea289d601486a0181c55af0bf3565a3518f2ff76ac449c2ae08673a7a285100f98b868c29d63e1af7673bd33b047120b8b438bbaf587d9334ed71aa40379a32be128bf3c5e1e9c3388d773ba292e577bd835e56f4ab7860d9eac01bd5e27df1b52a313d57a7a1f746a5b97e5d02a6ff6a76fe8f1176f073177ce67fa86ac2d8ec8cb76fbe2ca00f7a99e676b6b7edaec93f4ebb86d5a84547ba16dd02e41ecf051169dbc0021e7bb6622fe5472075066677af9cc83ef1f3f3450d510485fee0ff1ca500eaf4ce91664179c41b8b9f7a6f09baf87b80aa5c0fd714b99362613ab63dfc977e26cc47e4ae7c2565bbdfa6ad3d8280fabd193a34946e2898ef74ad66ba4cabdbd4786681edcd1b17b8285a55234e0cf189f72aa3fb062462596925db443dd733d6b4dcb424a8c33b6f4cd283519c266dc95ce55186fa891ab68d8a6eb43b65500a35b3d38b6e64bf8b5bbaaedacf13249948658f0df29683cbe936d833a5a448a917812bf63df3571702cf03e82ed98f9a191e28b25827d455fe0eaadf75e0064ec845beda0eac31cf2801ea9561c1363ed571589577cb1cf06e681dfc72d253d4fd7930a9aac438b0ac807768b9d8ee90d8c2b81d3eed5c2192a73ef3afb67ad65dbbd8e2900a48572402b8b141c2386cbcf5c502f05a83fe27cc389dcf03dd37005628527145af3bbdcd7a70dd9c5c1c95444bc4cfb56c8f6ec6eae6698fcabd23db40fc8d2d5af294e438b54e2e04c136b89c7c6b637fed9eb76b80f1a9cbf7a782c38a7130e79d22d395df037198e56b3cc3573c273707a4ad3ab74d28047d2d86a5e2419b5fbd8437d4ad146f23a8e38438d1f58c17f265bf9d8bc5144fcc16a8c037394e416e525671ee68b5a6d8ff38d7e27f0dadc4c2de1f9e884d6a5a173ad29aab576a4ba2e476b5efd1d719a1fa943abebf712b1eeb626505b634b96f3409b37508040d232355f8cd3f7abebe357d25359fe134e4e99fd529320231fb86cc9a60fbb24e79c2581ebc670419dda492badaac841c668bb48f6a1de6ed6e5ed418fa5790bf600aceb7102dc5ec0f245806731cb9412525051cac848f3f49fe38a928f07d471b9c93ecc5acde03e3308a717a28ea141422a92d4a5f2c3764a3df3524f7099bb1509a056528875805a44bab307fdb3589b5bceac118bf6e40d4c23fc3f814bca53c83ba4e52ec43f025ae089910df60a873ccd3554ca757e7408341bfd9511c2f088f3e0cba001d259219f6cd454484e557ead1a967cc747812ae46da556ca29c3e7b8c3efe1fdfbe8e284829e0e7cefe6362787183ab26be10ac2ac4fc124e9cf95ba1da021f0d227d9b697563a771c0d255e36b367b75a89d1551b1567ede335efe340fed188290e32e01a6efc13f23152724b41b7afa8d3311206db0e3fa034357d0cf2c4b8b84102c356bb5968501d8e54088c74f27bfb37ee4ff192a53d34ed97cfaeccba6f5d1663ed393af735b08f5001c46ddee6176d298712fe367e80ad2d4d11b7a66e8a2324c5734c2f1e899a2f89b98a8635af3d215a6e6c3777d37f7c2346c0fa3c1b3fa8b6ffe743c997752ac770f30626d855a32b239e083dbb37af777ef5de71c49c0cbc8ca982a2db18724386dd818b91a576ba26e9cff78fb978df53f6c1b06952c37dd0d65f073deb351d1072d97591f979a99477775346c34f29d0d06fce842cd3d7cd9cdc607324fefe354a34b35f4f677e5afac693cab1e76bdcb28a9d3b49662141dee2fefb3c577af852fe6403b2926219cf0dcd09d1888272754895453288153521479a1dec3e7b9fcb36161a9473e3901ba9d94f295165f6059cb9bee12112c02144d035e26760a4553912181258a7a246b524e25735d1fb70551eff7aab4fc365df25d4791cd4a1c446018bd6cf3e63a310101f37053e14e920efc8c8526327b3167d1783e1cccd6c56f3d70981cf8ef5607b258ffcd9cd94a99d3506f893a9ff207f6be2613e455b88fa7f7c424e7c0b6b7b585ddb2d068cc0932771e10c29b6a88a5149ccd0e5cc67d82b69fdf42ca82fb5a1c7b2e52c285d93bd2c103dc9a30fe2a94d6fbe542bac42d9352712c3cfc143741f5938c48d61f5e69bef34938154a9e62f5aaa524ded1d13260a7a3c2db0c9e187fc734cfddc7d12e54e5c49ce03c39a0deee7b267f81e7bf17d843cce5884388bc858aa5c021e69e9b6a32727c32bbef8c819005d2f34c01f74d6c78cd4e3dab5d05a5f6aecf931e09cc779701a18a46e30f00604d01490d091f355ea19d1fa260d1d37bf3adfec90e174f1537a3ea2af072134c299ebe7370389aff6c528ec280684641a26c7e552c8c54761f1fd8cde1cb4db6d94bb96dfcf7eb5fca25d022afd6521aa811b628aa1042b7265a0bba57d8ed6e4b7de51fe12f54cc84679ccaeeb40bc99d451d3da9d0f9a0698b700e35176035a4b244897f3ca88a4f6f7c7b7e2058e26eba6cfb30d828998ad58c7fda46fb4e4a50048cddd3cd674580b1a8b724d12e752d5359d9f9ffb6007fcf9f03abe016b828539d3cc7d8d85daff405ef8eeb78929bf9a81fd2c97cad2ce876d7936687deafd873fe789137dc718fac2e063348992a09deb6aa5c8beb38c8dfcf6736fba377c5a2b0ef68316541b207b215715bad20cdc9b8467d80e66727f7ad7f2e38e32106c5e6feacdf1e5cbc6e0667dd45381ddfeb0d9135b021f44280d600b1f5121d38394cd99be75965d1671b8009a6496e7259ad55101309e756cf825a5f2236453910da3ec4d901522d58a898837a41c9c66f07270b7c584e1c78bcd320d5dbc632c3ade0399bd495c1e5938a8f101490e6350c591db5716ea86d510a5fa5d1ac3462fa749ca053da82d62d06cd2c15bf749a2c769bbca289cb5bd57f820927b0ce15abd8d4d58e16da09edd12fbec7c18198f6cd9d561c9b06451ba3e63d2a28c4eb5b11323c1b9aa709337dc37f11f00cec03d98acaaf6e37f616235401c42b114651638eab1a2ce9265af51b7497f4fd466db5876c5914377d1a40537fdaa1cbbb4a83ba54f7c6ebd16f78ed27cd2397885a2a6a73c912282b3c3e40787da1c1c6cded1e2d41459da3abacb2bfdefc2e8418616ab5c3dee8f3f5061d47767c93a2acc4cf15295e697ebce758d1f400000000000000000000000000000004111d1f2832393c",
				"publicKey": "0x86d8688580bd2dfa1325dea9cf8b663c1a012898e6cb2cd55f0c235589979136244f7d19ea9f73de14237ad8115bba47bde31d201f691ea61ecf439f6a5341a539708f7276748fedf41e5eaaf32607068d36b60af0fef3280fc83066d2b54f654ccb79886814c096b97745d41d04239bf72f05854b16941612120bf3988ca817fc64d49318b016b237a08b0c9cfd6b6ae7b50ae1518551ed439b41b37e1c2a0a03a6ef5792cee6da5d4777b146d496f5ececdbd0bfa7cad22308ff589286688ec419d5e2e6c44e67975478f9dcff377cee5243c5da9e45133af3874c4cd09afb083ad4a44e14b3c80e200809daa0a37e186f205fa1a3855fc7ab2eb2aef62093edd69c6126458d6889e74929d2d0defe9120c3ff9b0fec6097538ec865316bdd3e3a60a72597c87d0f35785d12857a39b178df0751594c883a4e8348b64812f8a5625ebfff12394aa0224c0c7bdb05d7d05babf17d5b68b84a145f9659294674b8dbcfff4383bb48377d843fd2cd1b544f783b60f58c917067c8e61b63cadd058a88c342bba412dcdadc9cbda7be2b3eb7ccb91088d06826023d1b34ec13874604410db592356246e497879b43ce08d2272c95f74c470da36128340bc9c804935f1cd179c50c327826b286cad2ef8c3259d80fa12ea04ea519ad974b364381ede74930843d29857719f9895a49b4ef064c64febe48cad1a7c78b8221cce138794018262294cd6944bf2288ac4dcd6afa7e10bed5ab986f4dfc980e9a884d57d3094b4f12698ec3b4584a95fb4fe177b9bf77fbcdf0ee6fd76f94607d22a570d7e90ccdaaffb488420706427d067d0566e371411da44c17960826d4a06b7ae1e437514f3fdec246565bb435aabc1ddf9e4fae96642bce02dd9145c90180eba0c6c40a5e3a1b1a25608f9f853d4042cd43c6fa81d5ee71f2fe9531c47185eacedd556d938b4b38d578a62c5a1cbb438dc056801027fe06d52e30f62b35109eac568fb0fac6f7f45e54999557a34fd2e600881e8ff3ce71c493ed3271d59492d2e24f803216b02cb7d847a7ee9eebc906bbe2785716033a01128bb8175c3ace06ed4a2f21a94f7ef8b054d2380d06f0254cb826dbeee2655a703acb6eb5a5f96c7e1f0f0b45b2b778d25f300aa8d878af323e0837bebdab4214fcd20c7e8f9b7559126e3df62d39f916d88b5107cc064a22e402f9c634cbf1bbf7f21174423d19eeec4021b5248c1287140fc0cf40cf58bc0479bf64a90cead318ef8490a99a43698d4d1dd3ead299b9e19ad85b1e1c6a49bdfcf3f56945f6994e44421b5417881db981fcd60ecece2eea3a7309918dd342ca225c685e6b22134366e6e61afa8385fc13533f48f9da06ffb06671d55ec4cc82f1b86256f5e39b51b0ca07c0e33e57df47675dc54b2b062ea49465c2a6a2162f5a1b92eb4e8b28a15d9ffed6a3f61b38bca446bae0f88099c46e656c3fb9238406e36ede7c0a2fd51335e63ffe1a57b874c46e1e54f1f9d2ea415a8317a791e2a042ae4740c2060eacc16c12e1bd29a1a7249b71de15426efed92f6893db1d13108b74678f975f71051c752ec1f30e5cea2ccf08e2e9a606a192cb6fda8ae764f8541e9a89855353b008fb6ba7e3b146f6fbffc9b10072afa39e0f677845ab5a5e09abb7ea7effab4410090c7311788347d9b91cb8b278cc559253ed83bccbbdf3a901ac4c7c2c8bbcb531097518b9f44cc0683f823ad20700714d886270bece6fab98e0310c9821c4290cae19fe399455f26c561e21cda3431321759eb6546c4debd28ccfb5a1183ae5a5fe51f5d5a69088cc49635504d103d6b98f17ae7cb23a97c10db62840581a505ad23df06bf8a8a879002702b23bf8f4079ea8c30c2d0d9514db0ae6a99e32df1fdd3d6727735fab3a89e586f0558a4a619c2c0539c808024b73fbb73810758e3006fa37963d149bf6c9277e5c517ef7ad8aa603374ab714c2179bbfffbf2fbedb6525b5576bf61001f74f4be1f6c6c38a035da4dd97cca3aac8f385d0ccb241c32bdc971fc599e63100295bf7b1a3aa1ded9669f7ea197ae9e191dc967c1a9361337b493b4395ca8f9dc7582cbdc7c8838ec1dd376d916e896f3109170543399771a75b6f6be27fd1f820dbe8ae17a3be7c184c8dfc2687f0a1b91b96f029f3e10bdb33e02154fc2c587fa99315e0378cdd387d5b7470bcba1f146539fe9c79afc3aaef0c3ffe02b96cc5ff1e9ec3e3e0ac984f17fadb7d15210c8fe8505420b0b3fd60f1269f6d5530aa6f7356f62a7a860c6f238fd57b3329560d19e35443b1238e3eab2b2f5cd19c1ca6e01428c6784e985bc26f6698540f65987dc9cf616ad1f4ef15b5e0e4ce31bfa7c28567d7909aeb3300abb7fe2445cf1a03919532ff56cd47aaf98a6b82ee589cf4ac92c1c42902880242c77481f627b5ccb0c98067cc257e28e10ab76d32ab31bea16894a9f3b814ed755f18d4aabdfd2f6a53308b146e3aea30d8a89edd5d134355c90b62c5c0be711d1b669125c26e96c7f9e6fabd8d03102a3e2edd6be27be9731083e2c03b9e907a0a77f450fe76ecbe2e2e4ec033d4d921ae1544187805529bc5fa71090bcfd205785c364f3c8febb255000a6d9cb10408441b402f6c878a52f10113b271189d2ad2b4850e34862575fbcb5078f9533bd71276e1689b2203a0e4a02a81729fd841fe95e38fc4d619e433ba1809b1684329e3c258f63477ddcab14251458f73bb19469db62a68c2ee14dcd64afb918c06831b5f84665f4070b3e163e24bb40e644195811aba50294c72c4d350b5c0379917116b254bd1e70012548ddc155e947c512d9c76d743c684ef55621de7f248c1f01b920958233e3a6627c78fb79334caadefb62a83cf8a7e0d300a0064d6f236ff915f08a6830956a28801e9f3cc44da6ce1b2ce9d4a33918a1923c3945aecaf5b5fa6f67a7b2205854338e11f611dd46874ecfcc8e047e4fc7acb0181691ce3b47c10da907d5c94c3d2d513334f96cf7af05971a00462948e5960939149a36820163ae174257bd95619984841104da69db9459994c2ed95ecbc2525abf9b31581da5fda4d26611e6db65a6058285fb9bae4092773fb51eb7c96fec43a9fb0224bdf85df832f39d508a2667f8bc57c4bf3fef795490bc72884abf6ab811fabe8c7633037de916770e7ab1c3fd23fb0e68def066eb61be05d745ce2eba2dcdfb5a4bf2bb642efbb679f64ebfb0214ceb2c6df68028effa5a2352efe006e282820d8ab04d5297d9987c4f9c60e11e66f07509c78e8fa5b69abc9e0f1808f47f7aab5bd00f299217b9053e4b33d1857be7860239f1e24fd94ee646eaa86dd4bed6b14feb961791f1f337656d4929bab745292ed5b8a422018af6373be399e707ff3972c2084db4fb7d3951cf66837fa67054f7bc08cb223c648050c7e033dcfc3acb22c644595a256207a00d6f9225a5b545cb4ff0b648933506d89d7639ed8e06f782122b1596c82bb3d4b6a349d068b53ad68091d6b7296da632a03c60f0a5a202c951c0a6c5a0b31df1b55e10df24b3565ae4bd936f6a2ede1a1b082253acf6fade2819695d3d5971788e325418b79e233d9e85c9be206694f21bfd163e6aa8986c3b10d94bcff28058156ff15102d9ab4fdc1508bd8c19a4754064547b47fba",
				"descriptor": "0x010000"
			}`,
		},
		{
			Tx: &types.DynamicFeeTx{
				ChainID:    config.ChainID,
				Nonce:      5,
				GasTipCap:  big.NewInt(6),
				GasFeeCap:  big.NewInt(9),
				Gas:        7,
				To:         nil,
				Value:      big.NewInt(8),
				Data:       []byte{0, 1, 2, 3, 4},
				AccessList: types.AccessList{},
				Signature:  []byte{},
				PublicKey:  []byte{},
				Descriptor: []byte{},
			},
			Want: `{
					"blockHash": null,
					"blockNumber": null,
					"from": "Qdf45784bb8fb8c5f31cb3e27cb8fa3b40d855618",
					"gas": "0x7",
					"gasPrice": "0x9",
					"maxFeePerGas": "0x9",
					"maxPriorityFeePerGas": "0x6",
					"hash": "0x05379c44dce873fbdb1b49cb7849a1cc2855b33550fb2d8e8d67681609e295e2",
					"input": "0x0001020304",
					"nonce": "0x5",
					"to": null,
					"transactionIndex": null,
					"value": "0x8",
					"type": "0x2",
					"accessList": [],
					"chainId": "0x539",
					"signature": "0xfef4ec2787762b74fbb2083c4abd087ae2230ed35efc8d608c8d0bc21b2909222263e6c1da4983a634dce20972e61d07cd7d7f11916c39f0dc46be28f67fe7af52b6140bb215169cef31de501d48ea70900922e039dafde00315e4060dab21fd9ed080acc212684bb23f137793fff16c0990c01e5c9b80c3fe67cbde5476b9062bdd7ded6f4bb677d723ec461aca32d4e4d1f81134410db04c19b93135a9486ff7afcb1370eb1e9dc3d115ee0aa5ae5743622f970761b8b57fe84f0c48e1330a077c9571881afe1ff7f8c7e8d04cad3e462b610f0ecd6eee31ca81a5eb9687e9fb41acff8fb6a90857c96454072ed009577a0992dbb1a93d91a77ec2ee63dc3d81daef74663b12810c151fe040bdb75b6237c9a86f3fe5ebf3703a1142c7efa81e966ccf05a494828a2666d947611502de9e62e2f3c15bf29e22c8653b1e936bc9cfc18e4644116ff1c0cd37714718c2e5c5032cd2bc76b11470bd1eec4595e8a36b39ef2d7291d40a3fbbfbf9f78ca595596915bd7698ce0ad52b1bf9a38c6be712cd433dafdefe52186821849efb92bd21cb97d05cbf22ba9e8503b79ef3a233f2245898646919155947e56342bdc81e2046d022266c07486b284c1f1cb389e90b5042540ce081f17483eea2a8829df14f034a11a8316c4e5d13d8852773015826db8fa30db031d70eb34ea1d5fbd2c1f23a2927860aebf14a2270edd39e5a99752281ef15485b109e1b19476eb1d2587278a61b95b42ab3fe187d97c3a39a97cae263bbd60c46600db502646b085a11533706c3f16363ab876f64632dfc5665d3181b47e3156ad0650aa239097c71880b2fe1b294e16f02cd76876798aa74ad3d36d1f997354ae34a98c8d4692f1dda1981260e1123b974aacc3ec1e1e44682a5d47caaa5645411dd80003f402155809dafaa607a96acaaf5b97aa174c2be6b541a13532ecf1f02806b82a39a628057a0caf0a0f78104f26d8ac9f3444709507248738c339290b23ffef8bf247dfeade89b36bf81fcb08719ff9f08abb097c553ba5c3c69d89af8d5776a2a63ac506574fc797d3477f43d9996125fd1af929f29ec100fbfb94ffa60405f8b801aa81d2a15b9089ffef3c39884b3efce555a08c349a349e3a5f3f98e7ac21e0e860c7d395d1ec86ca98e72479a2fd847ab9812ac22c25358f5f05328e2abbba1a39b2c7b74d906e5ed559082efe66c231c5fd006b241621e5a980cbe00e140b1feed4017f1a943d090204955109c531481e411edc349bee4557506bb52f837ce5e18770b5bdac81c570011c602a42307ce541c46515e50b15b36b621159944968ce52ab1f7060beaed09f9b27821bbd8ba4d695c51a17a88b931ae474632eafc16c3e8413f4bc4529b19c7ac3d295ff401e8f30abd4b7488f64b9153a42230a4080fe248d3ab4ab0ca9441410c65140b78bbcf531804145cda319b5280be933ba365b52c5fc0551b8f7eb38edbb1c8ba8f4cc5a4526e041d534b8a76487b203f6ad057aec46e4727132fdba7000fa18d21689aa1c1445623bccc1295d2215fbebd96233a45df3846c0f4236e5b683ecb027ef15a3047cdf47b1ad9d2da1482b5f0d6377853654edcbbff66c20f1c87c711693707e5c5f634980bbb3c5a10b2af03243be83e51b81546bce907f22f26d091cc6faf4f91c9e4b8ea00fe039b4ace915e575659e10c11f4bd534010b5f087d81882a89fe28a691759e887a3d7f02fd26bd8ade177579cff3ef9f39ec214edaecf190d7a3290c04a036f0e40b778b70a46e75336a4179023cf63582b8d1131090188b79f3a37d1675e8ba3000af98b2eaf8fe6409001a5a66a93a9e0e1aa40696f066ef9d87fc5cc9f1b689501607dab9fbed03a571f158880533a1967de16e6e7062fd3a6425ff8398201c13abb28275f2551fcfb5c2ecb10a53256086cf33864e0066857f0365c06c55f4b43b0b6e1b70e081977d1aec2b2ff321942199c3cd4dd674c0b7851ac479c19c88e860e9c422fe62ae1d51b0b3e4a202722d1a1a91a44d202f038a0a46c4459cadf920d8d0b38a3cc3538a615b6d0392f0e423b9c646331ddcf962ae087926a634b23fec7d6e38e1352437f9db29e8f5be6f8880c950e58ec14226a70761b1790bea8d14d92c75c73d64542379d64a316d1898ec5b53159be6e96bc735630b659415e5edd4000687517b37bf68ce1a7c4127002a72b52c52ed6aa1211483329037320ab872d219aa5ea6cdfc8e996a28638c4ba01c7b92bdc5f457942608ff9ca976b412d0db870302506e340e1039439b6d09b6eeb668cde83e2fd34689f21e26ba78603a2abcfad17822868bce7b848933b4fbc9a54991e147eafd610bf91530489f71a2c6015dafe69b5c0ef1efeefcb883b9d939ae1c0a13473c486cce239f5b3433136234c5c1d0376245b8404c688920da5ffa044b499827cbc66896c52d2cc7a15565735f00901474737286c98618adf17bbafafb822eb60440ebfb47f35315533e2437112e60d1e4a6322ade519ff821ebbf279526c3f2b01946b1e2d6e9e979d2b57d22f7b3341fb8def8876db6ecb98943a28e7c78a44802c8bd13b0f9e476b7b42189de20447c54d3079186ca0700d87fab0f73186997248a05945bfd4c1e96b43e231730c6ef6fc3d73fdb6ea835baf42d825669b2f7c1c9a4416b9ed2c3f042d196059dad61cb5c9b240600875fa34cd86724d7d0698705c5bed2618b0709fd698176acc062764ddb738bc62e829a86e659864038469fc4680b12f1b0ee7a7c4b6e08ba21e48ce65dde648f7b48b3767b30a364c190cb67fc2a5a34ce827a9eed6b8f848802fdb610181f431e23018a802ac857a4a91d4b9cd3653c014239fb413a4f7ec6f13a96c7e629306e5676ecac62828a0a80013327b8d4f000c6a39e11d014bd2c5952357fdbe8ec88a79e6a9595db92701d08a52b9bf33e6a3d3187fccaf57e7655c58195da717e32a30636192bc4690905a2d532e5b131bcb4db1db2226cc41d4b83f08deef509de0d95aa7cbf4cd1791a12a32df2f5117bdef8edabdc9a54cd9e161597dd5aa0cf9a285e1ee2858d3c0dd854cf7b2a71f96a93bbb7b4b9c92a47b3a921b00a062665badb230e19c108932e86f4c7f154df2bbfc4ab3fbf5bb38f7b8b226d76fd8eab03fb8e96bc494a92180a4a12944cfeb5e5f80b2020c002bbe6df4458eb290eba336c9f03da49b01a656d5e5887371f5d4c0e1437838914cc8466797a4459339efe8c9dcf38ab68fb647c5effb9fa44f8c2da5b3a3bc8f2e08e42e181384dd9ffc9a94bb46be430a58ff8056e08931c8faa49e9266d58d64adac7868e80e5f71006fab32be91cc40e4b0e1607412c9b02387f1a7e3f28548d729c9daddd31861fd3d5909e422de73166523618632be50ad5a4be862aa2ceaf48eaf45b2f60bd2c41854b69223a492f2a626c89d377be7efcca9db6894a2edf6118b6af57a232ca5c200b41fedd6a894962fa68c2d9e56f3814e4154f5bf58b8f5353e5b212bb353a5ed12738a2947a472299aec83d4e4687390c4437c9593be6944f47d05288c684528390630b533c93deda8aa1091ff81e1d3e4b41efa3d5f6ebde698224bab33fc0a181e894554eb0758ba1be2b7c555c74bd5b9710ad6da7818ad0b9a33725f927c04937644e51f0e3b48bc8ecf36f89b4855843a2fa1b31f40456be7cc48c664f5f79e6df7695c1ee26b09b1946a01ddc294796145fce0d497e521cff7d7f1d8380c1d1a9cb364c6c0e95a35b657ef3389c0386b9d35c957093d7c435818ffecee40a30d94cb937db74463d05617997a9a84eeb0a35a9cfb89a1106c31f4745b637790f7a9f71d0d36f49163c16340b42312bcc54e4df443987e076a8045350a62a3bea5f35b15d4a95cee9471ec4577070509b76847564f57994767ded66176f278e6cf706420c01581f0d74490f6cd2dc2ad9f851afdb11d04dc2d67811cd557753e6b640c809ac8d1ef6dc2ff10a609542700c9a793d48a3612598edc254aa84500c67be26d837d4093c4130f537d4d1341b5c93c097606d3dbb881b1169cbf2f2509c9689d49a545bc8dfc014033854fba0a1e16374fc932f34f6aeb70ead1a8c67a4fe7fbd4c13296d8a38c56052b5289aa9d6550ce4811f8c841fbdace31be8a16f592bf6ca54eb5d92dd117c249fbd97f292e8296acb87de00d2dde81c26359261fb404207bb880a1a07fbafd407bd037b50421c9d53aef17cca1a5b47471e1d70bb4c84ce107b71c8cc27e2cf3c82edacd077cf153542571e9b14945a75ec94d3883d5891ac7433dd1f6d7af8d023be64665abb1135d97c665ab91379ca2c1f09935d9074a0bf5203489968a1d2dbdbccf13fb1f7a98a6f281928626f6498ecc6aecc96d2edeb269de32d4fb6074cf6998dfa4c8342648b219ef15da1471d4beb0adca3593cf1f2c83ba76aa16b43ccec6206a8ac7dee88a9677f199a0c36a6045e1d66babddacac2703871e6067de07e02914050dbfebfe0637b0cacd5da564820c5bd9525fcb94f3056b920b5a0ecfa76b8cbde28b13d71a9d44b35ec590721e1567709e92d5d49c828c0f67a3b79e301d3364b7cd2a3ce0b048cdcacc9be72bf5b0ab2d65d30434c5b6b465fe13c516ad8bf09716a2d7a638a8abe3a16e3fc216b2ae35e5530d92862c51d01a5882758d15b6c1dd9dfea38edd2686701fe6204864de222951fec7d9f7ea26bfc6d32a149dcd43365124843f62879fb621fdb854d01d4eee6d0320f1221553683d301b06670a8288b98a0d448d88e77d3bc5be91c8a62dfbb8e83907d9ac526bb842a78b43801c7126892b9915b1d362afd7d294e19ccfe4c4f22150d5953f0003e130b8ea8b8ea9e306c8c4fcf3301a985fe2be71ccd188c137a2b38bdfca80292c45efa3ee14cc56333853daf5226ad1e76c7c665f6b7a3230641a124429de00a2b75da31dfef469f2df1876344f50a5ae0ae875999b34d9b2c3d524c8aea56db53646df23c094222494087cb8f71ed84898e1a99e1cb37d430bfbbd275a632cbf61bf203033e2b426d387a21cae6944d0a01d30d94e3f4662a9dc61bb8ca4c31df86cd6074f2b132f56acd782865de70354264130dace71425c99f7a7d0a02d8af28cda47279375bf26aba9facc8aa48b4f0d445245bf75c21b78a782ac51f00fbf72c3c626ad13b8719cdcf9de01a5165287f475cbbfe41cf8cb1daf431fb3205302f22a661445a77a18146a58a6283da4846b4e8364cf468ab1934c184005200679b9c2d36010b5654b295fd6c1f0b0420ac1bc47d06b3b6ce9c7d6b71e0ee6a61e57d2e2abbcebe33d420a6c3c85697ae58ff00a1b20870fd45646f6dd08c2507e53b98495a9ff3329cad815b19353e72c855ed4b00f5941adee77755fa821175338e17b121e4161a5c0875a023a1319c66747d08da8cbdc20eb23440d4903ede774ae9e0bb0a9976a0c960f4528a0ec12b715075522e87f1c46215e21d0911af139e8eff51714d8051677b1b83a7328bbf2bb6967fdb133dd224c011356370b4ad797da346f1707e8665839c315cfa102b15d50142629eebcf6f1d67e5928c972e5cb5e2e160c1aabf3fe80d68fc0e9a858745c0f4987ef710a1f6455508b77b48199ef1ace08efb0b007e9887ec523dd17717444204e64326c4fa98edb41a983f9c05701f61c281d3750ce51d0f554872f6c76315e59eed306449952ca00c8f9da7386d0efc0cb7a8bc820b91d0d69374af283f26caf488bc6eb2070903ee22adad1d912cbf73e27489b262a4a1e56e431f9e6ba55a7ad80e9d190ca0c94d3d0125826223aa7cc45534a68b2d690ab05cbaa9f11243e2455ead0ec579bc7418afd8ec0279a9b8a2f1ce26f010211eedf34f9a0e75d0ccbab99bbb7e7dc9b77f5c9a9c92b2b86eb1cbbc0fd085b9232a6d3253a1b4f9160b982a0dfbc890740c9eafac8c237ef0d41d55012f7f304a6cfc896888d0bb6231d8c0028ebd9ef15576f1b2ce466a54642f08e362f779b25af1c659a01bc627e1062b90b7de95f83d8cf1be44013eba541d7243ae2e6d1b0e803d334f83233e00a1f6a670ddb299d30683788e3bc48c24e81e236bd944a2bdcef07613cf020b49422f4e877bf7fdf5cb7167e0c6cff00da4438b212956ccd3d7eac36ad876d5e75035ccf01262a95af7ba8e2b6f874095d0759a00c50acfcb17ca8d703537d7f478c7159285c31a31b6df110c8e2d50870b0fd2164c229fb1f5dafbad5ebeda9d8ced73fcd075ed3341c2e323e9aedb32b185aa74d8f3fc82b009a1a9647f3aefdaa08b97a7bad0846b6c4b45c65341b337ebdd89db1a91e0fa24d74dae110329f52666b15a5ec6e5c30612e78075cfc653f87436b71ac60dc0b519f4c059a03ecb54f721fd3a7fb10587417d1552f169b3b0a122a3c48dbe5e7f1f6f815969da2043234374e9c112f5171fa135d81254d565a6ab5f8163e4c91b3c9f7fe3f59617981b2bcd00000000000000000000000000000000000000000000000000a0e14191c232b33",
					"publicKey": "0x86d8688580bd2dfa1325dea9cf8b663c1a012898e6cb2cd55f0c235589979136244f7d19ea9f73de14237ad8115bba47bde31d201f691ea61ecf439f6a5341a539708f7276748fedf41e5eaaf32607068d36b60af0fef3280fc83066d2b54f654ccb79886814c096b97745d41d04239bf72f05854b16941612120bf3988ca817fc64d49318b016b237a08b0c9cfd6b6ae7b50ae1518551ed439b41b37e1c2a0a03a6ef5792cee6da5d4777b146d496f5ececdbd0bfa7cad22308ff589286688ec419d5e2e6c44e67975478f9dcff377cee5243c5da9e45133af3874c4cd09afb083ad4a44e14b3c80e200809daa0a37e186f205fa1a3855fc7ab2eb2aef62093edd69c6126458d6889e74929d2d0defe9120c3ff9b0fec6097538ec865316bdd3e3a60a72597c87d0f35785d12857a39b178df0751594c883a4e8348b64812f8a5625ebfff12394aa0224c0c7bdb05d7d05babf17d5b68b84a145f9659294674b8dbcfff4383bb48377d843fd2cd1b544f783b60f58c917067c8e61b63cadd058a88c342bba412dcdadc9cbda7be2b3eb7ccb91088d06826023d1b34ec13874604410db592356246e497879b43ce08d2272c95f74c470da36128340bc9c804935f1cd179c50c327826b286cad2ef8c3259d80fa12ea04ea519ad974b364381ede74930843d29857719f9895a49b4ef064c64febe48cad1a7c78b8221cce138794018262294cd6944bf2288ac4dcd6afa7e10bed5ab986f4dfc980e9a884d57d3094b4f12698ec3b4584a95fb4fe177b9bf77fbcdf0ee6fd76f94607d22a570d7e90ccdaaffb488420706427d067d0566e371411da44c17960826d4a06b7ae1e437514f3fdec246565bb435aabc1ddf9e4fae96642bce02dd9145c90180eba0c6c40a5e3a1b1a25608f9f853d4042cd43c6fa81d5ee71f2fe9531c47185eacedd556d938b4b38d578a62c5a1cbb438dc056801027fe06d52e30f62b35109eac568fb0fac6f7f45e54999557a34fd2e600881e8ff3ce71c493ed3271d59492d2e24f803216b02cb7d847a7ee9eebc906bbe2785716033a01128bb8175c3ace06ed4a2f21a94f7ef8b054d2380d06f0254cb826dbeee2655a703acb6eb5a5f96c7e1f0f0b45b2b778d25f300aa8d878af323e0837bebdab4214fcd20c7e8f9b7559126e3df62d39f916d88b5107cc064a22e402f9c634cbf1bbf7f21174423d19eeec4021b5248c1287140fc0cf40cf58bc0479bf64a90cead318ef8490a99a43698d4d1dd3ead299b9e19ad85b1e1c6a49bdfcf3f56945f6994e44421b5417881db981fcd60ecece2eea3a7309918dd342ca225c685e6b22134366e6e61afa8385fc13533f48f9da06ffb06671d55ec4cc82f1b86256f5e39b51b0ca07c0e33e57df47675dc54b2b062ea49465c2a6a2162f5a1b92eb4e8b28a15d9ffed6a3f61b38bca446bae0f88099c46e656c3fb9238406e36ede7c0a2fd51335e63ffe1a57b874c46e1e54f1f9d2ea415a8317a791e2a042ae4740c2060eacc16c12e1bd29a1a7249b71de15426efed92f6893db1d13108b74678f975f71051c752ec1f30e5cea2ccf08e2e9a606a192cb6fda8ae764f8541e9a89855353b008fb6ba7e3b146f6fbffc9b10072afa39e0f677845ab5a5e09abb7ea7effab4410090c7311788347d9b91cb8b278cc559253ed83bccbbdf3a901ac4c7c2c8bbcb531097518b9f44cc0683f823ad20700714d886270bece6fab98e0310c9821c4290cae19fe399455f26c561e21cda3431321759eb6546c4debd28ccfb5a1183ae5a5fe51f5d5a69088cc49635504d103d6b98f17ae7cb23a97c10db62840581a505ad23df06bf8a8a879002702b23bf8f4079ea8c30c2d0d9514db0ae6a99e32df1fdd3d6727735fab3a89e586f0558a4a619c2c0539c808024b73fbb73810758e3006fa37963d149bf6c9277e5c517ef7ad8aa603374ab714c2179bbfffbf2fbedb6525b5576bf61001f74f4be1f6c6c38a035da4dd97cca3aac8f385d0ccb241c32bdc971fc599e63100295bf7b1a3aa1ded9669f7ea197ae9e191dc967c1a9361337b493b4395ca8f9dc7582cbdc7c8838ec1dd376d916e896f3109170543399771a75b6f6be27fd1f820dbe8ae17a3be7c184c8dfc2687f0a1b91b96f029f3e10bdb33e02154fc2c587fa99315e0378cdd387d5b7470bcba1f146539fe9c79afc3aaef0c3ffe02b96cc5ff1e9ec3e3e0ac984f17fadb7d15210c8fe8505420b0b3fd60f1269f6d5530aa6f7356f62a7a860c6f238fd57b3329560d19e35443b1238e3eab2b2f5cd19c1ca6e01428c6784e985bc26f6698540f65987dc9cf616ad1f4ef15b5e0e4ce31bfa7c28567d7909aeb3300abb7fe2445cf1a03919532ff56cd47aaf98a6b82ee589cf4ac92c1c42902880242c77481f627b5ccb0c98067cc257e28e10ab76d32ab31bea16894a9f3b814ed755f18d4aabdfd2f6a53308b146e3aea30d8a89edd5d134355c90b62c5c0be711d1b669125c26e96c7f9e6fabd8d03102a3e2edd6be27be9731083e2c03b9e907a0a77f450fe76ecbe2e2e4ec033d4d921ae1544187805529bc5fa71090bcfd205785c364f3c8febb255000a6d9cb10408441b402f6c878a52f10113b271189d2ad2b4850e34862575fbcb5078f9533bd71276e1689b2203a0e4a02a81729fd841fe95e38fc4d619e433ba1809b1684329e3c258f63477ddcab14251458f73bb19469db62a68c2ee14dcd64afb918c06831b5f84665f4070b3e163e24bb40e644195811aba50294c72c4d350b5c0379917116b254bd1e70012548ddc155e947c512d9c76d743c684ef55621de7f248c1f01b920958233e3a6627c78fb79334caadefb62a83cf8a7e0d300a0064d6f236ff915f08a6830956a28801e9f3cc44da6ce1b2ce9d4a33918a1923c3945aecaf5b5fa6f67a7b2205854338e11f611dd46874ecfcc8e047e4fc7acb0181691ce3b47c10da907d5c94c3d2d513334f96cf7af05971a00462948e5960939149a36820163ae174257bd95619984841104da69db9459994c2ed95ecbc2525abf9b31581da5fda4d26611e6db65a6058285fb9bae4092773fb51eb7c96fec43a9fb0224bdf85df832f39d508a2667f8bc57c4bf3fef795490bc72884abf6ab811fabe8c7633037de916770e7ab1c3fd23fb0e68def066eb61be05d745ce2eba2dcdfb5a4bf2bb642efbb679f64ebfb0214ceb2c6df68028effa5a2352efe006e282820d8ab04d5297d9987c4f9c60e11e66f07509c78e8fa5b69abc9e0f1808f47f7aab5bd00f299217b9053e4b33d1857be7860239f1e24fd94ee646eaa86dd4bed6b14feb961791f1f337656d4929bab745292ed5b8a422018af6373be399e707ff3972c2084db4fb7d3951cf66837fa67054f7bc08cb223c648050c7e033dcfc3acb22c644595a256207a00d6f9225a5b545cb4ff0b648933506d89d7639ed8e06f782122b1596c82bb3d4b6a349d068b53ad68091d6b7296da632a03c60f0a5a202c951c0a6c5a0b31df1b55e10df24b3565ae4bd936f6a2ede1a1b082253acf6fade2819695d3d5971788e325418b79e233d9e85c9be206694f21bfd163e6aa8986c3b10d94bcff28058156ff15102d9ab4fdc1508bd8c19a4754064547b47fba",
					"descriptor": "0x010000"
				}`,
		},
	}
}

type testBackend struct {
	db      qrldb.Database
	chain   *core.BlockChain
	pending *types.Block
}

func newTestBackend(t *testing.T, n int, gspec *core.Genesis, engine consensus.Engine, generator func(i int, b *core.BlockGen)) *testBackend {
	var (
		cacheConfig = &core.CacheConfig{
			TrieCleanLimit:    256,
			TrieDirtyLimit:    256,
			TrieTimeLimit:     5 * time.Minute,
			SnapshotLimit:     0,
			TrieDirtyDisabled: true, // Archive mode
		}
	)
	// Generate blocks for testing
	db, blocks, _ := core.GenerateChainWithGenesis(gspec, engine, n, generator)
	txlookupLimit := uint64(0)
	chain, err := core.NewBlockChain(db, cacheConfig, gspec, engine, vm.Config{}, &txlookupLimit)
	if err != nil {
		t.Fatalf("failed to create tester chain: %v", err)
	}
	if n, err := chain.InsertChain(blocks); err != nil {
		t.Fatalf("block %d: failed to insert into chain: %v", n, err)
	}

	backend := &testBackend{db: db, chain: chain}
	return backend
}

func (b *testBackend) setPendingBlock(block *types.Block) {
	b.pending = block
}

func (b testBackend) SyncProgress() qrl.SyncProgress { return qrl.SyncProgress{} }
func (b testBackend) SuggestGasTipCap(ctx context.Context) (*big.Int, error) {
	return big.NewInt(0), nil
}
func (b testBackend) FeeHistory(ctx context.Context, blockCount uint64, lastBlock rpc.BlockNumber, rewardPercentiles []float64) (*big.Int, [][]*big.Int, []*big.Int, []float64, error) {
	return nil, nil, nil, nil, nil
}
func (b testBackend) ChainDb() qrldb.Database           { return b.db }
func (b testBackend) AccountManager() *accounts.Manager { return nil }
func (b testBackend) ExtRPCEnabled() bool               { return false }
func (b testBackend) RPCGasCap() uint64                 { return 10000000 }
func (b testBackend) RPCQRVMTimeout() time.Duration     { return time.Second }
func (b testBackend) RPCTxFeeCap() float64              { return 0 }
func (b testBackend) SetHead(number uint64)             {}
func (b testBackend) HeaderByNumber(ctx context.Context, number rpc.BlockNumber) (*types.Header, error) {
	if number == rpc.LatestBlockNumber {
		return b.chain.CurrentBlock(), nil
	}
	if number == rpc.PendingBlockNumber && b.pending != nil {
		return b.pending.Header(), nil
	}
	return b.chain.GetHeaderByNumber(uint64(number)), nil
}
func (b testBackend) HeaderByHash(ctx context.Context, hash common.Hash) (*types.Header, error) {
	return b.chain.GetHeaderByHash(hash), nil
}
func (b testBackend) HeaderByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*types.Header, error) {
	if blockNr, ok := blockNrOrHash.Number(); ok {
		return b.HeaderByNumber(ctx, blockNr)
	}
	if blockHash, ok := blockNrOrHash.Hash(); ok {
		return b.HeaderByHash(ctx, blockHash)
	}
	panic("unknown type rpc.BlockNumberOrHash")
}
func (b testBackend) CurrentHeader() *types.Header { return b.chain.CurrentBlock() }
func (b testBackend) CurrentBlock() *types.Header  { return b.chain.CurrentBlock() }
func (b testBackend) BlockByNumber(ctx context.Context, number rpc.BlockNumber) (*types.Block, error) {
	if number == rpc.LatestBlockNumber {
		head := b.chain.CurrentBlock()
		return b.chain.GetBlock(head.Hash(), head.Number.Uint64()), nil
	}
	if number == rpc.PendingBlockNumber {
		return b.pending, nil
	}
	return b.chain.GetBlockByNumber(uint64(number)), nil
}
func (b testBackend) BlockByHash(ctx context.Context, hash common.Hash) (*types.Block, error) {
	return b.chain.GetBlockByHash(hash), nil
}
func (b testBackend) BlockByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*types.Block, error) {
	if blockNr, ok := blockNrOrHash.Number(); ok {
		return b.BlockByNumber(ctx, blockNr)
	}
	if blockHash, ok := blockNrOrHash.Hash(); ok {
		return b.BlockByHash(ctx, blockHash)
	}
	panic("unknown type rpc.BlockNumberOrHash")
}
func (b testBackend) GetBody(ctx context.Context, hash common.Hash, number rpc.BlockNumber) (*types.Body, error) {
	return b.chain.GetBlock(hash, uint64(number.Int64())).Body(), nil
}
func (b testBackend) StateAndHeaderByNumber(ctx context.Context, number rpc.BlockNumber) (*state.StateDB, *types.Header, error) {
	if number == rpc.PendingBlockNumber {
		panic("pending state not implemented")
	}
	header, err := b.HeaderByNumber(ctx, number)
	if err != nil {
		return nil, nil, err
	}
	if header == nil {
		return nil, nil, errors.New("header not found")
	}
	stateDb, err := b.chain.StateAt(header.Root)
	return stateDb, header, err
}
func (b testBackend) StateAndHeaderByNumberOrHash(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (*state.StateDB, *types.Header, error) {
	if blockNr, ok := blockNrOrHash.Number(); ok {
		return b.StateAndHeaderByNumber(ctx, blockNr)
	}
	panic("only implemented for number")
}
func (b testBackend) Pending() (*types.Block, types.Receipts, *state.StateDB) { panic("implement me") }
func (b testBackend) GetReceipts(ctx context.Context, hash common.Hash) (types.Receipts, error) {
	header, err := b.HeaderByHash(ctx, hash)
	if header == nil || err != nil {
		return nil, err
	}
	receipts := rawdb.ReadReceipts(b.db, hash, header.Number.Uint64(), header.Time, b.chain.Config())
	return receipts, nil
}

func (b testBackend) GetQRVM(ctx context.Context, msg *core.Message, state *state.StateDB, header *types.Header, vmConfig *vm.Config, blockContext *vm.BlockContext) *vm.QRVM {
	if vmConfig == nil {
		vmConfig = b.chain.GetVMConfig()
	}
	txContext := core.NewQRVMTxContext(msg)
	context := core.NewQRVMBlockContext(header, b.chain, nil)
	if blockContext != nil {
		context = *blockContext
	}
	return vm.NewQRVM(context, txContext, state, b.chain.Config(), *vmConfig)
}
func (b testBackend) SubscribeChainEvent(ch chan<- core.ChainEvent) event.Subscription {
	panic("implement me")
}
func (b testBackend) SubscribeChainHeadEvent(ch chan<- core.ChainHeadEvent) event.Subscription {
	panic("implement me")
}
func (b testBackend) SubscribeChainSideEvent(ch chan<- core.ChainSideEvent) event.Subscription {
	panic("implement me")
}
func (b testBackend) SendTx(ctx context.Context, signedTx *types.Transaction) error {
	panic("implement me")
}
func (b testBackend) GetTransaction(ctx context.Context, txHash common.Hash) (*types.Transaction, common.Hash, uint64, uint64, error) {
	tx, blockHash, blockNumber, index := rawdb.ReadTransaction(b.db, txHash)
	return tx, blockHash, blockNumber, index, nil
}
func (b testBackend) GetPoolTransactions() (types.Transactions, error)         { panic("implement me") }
func (b testBackend) GetPoolTransaction(txHash common.Hash) *types.Transaction { panic("implement me") }
func (b testBackend) GetPoolNonce(ctx context.Context, addr common.Address) (uint64, error) {
	panic("implement me")
}
func (b testBackend) Stats() (pending int, queued int) { panic("implement me") }
func (b testBackend) TxPoolContent() (map[common.Address][]*types.Transaction, map[common.Address][]*types.Transaction) {
	panic("implement me")
}
func (b testBackend) TxPoolContentFrom(addr common.Address) ([]*types.Transaction, []*types.Transaction) {
	panic("implement me")
}
func (b testBackend) SubscribeNewTxsEvent(events chan<- core.NewTxsEvent) event.Subscription {
	panic("implement me")
}
func (b testBackend) ChainConfig() *params.ChainConfig { return b.chain.Config() }
func (b testBackend) Engine() consensus.Engine         { return b.chain.Engine() }
func (b testBackend) GetLogs(ctx context.Context, blockHash common.Hash, number uint64) ([][]*types.Log, error) {
	panic("implement me")
}
func (b testBackend) SubscribeRemovedLogsEvent(ch chan<- core.RemovedLogsEvent) event.Subscription {
	panic("implement me")
}
func (b testBackend) SubscribeLogsEvent(ch chan<- []*types.Log) event.Subscription {
	panic("implement me")
}
func (b testBackend) BloomStatus() (uint64, uint64) { panic("implement me") }
func (b testBackend) ServiceFilter(ctx context.Context, session *bloombits.MatcherSession) {
	panic("implement me")
}

func TestEstimateGas(t *testing.T) {
	t.Parallel()
	// Initialize test accounts
	var (
		accounts = newAccounts(2)
		genesis  = &core.Genesis{
			Config: params.TestChainConfig,
			Alloc: core.GenesisAlloc{
				accounts[0].addr: {Balance: big.NewInt(params.Quanta)},
				accounts[1].addr: {Balance: big.NewInt(params.Quanta)},
			},
		}
		genBlocks      = 10
		signer         = types.ShanghaiSigner{ChainId: big.NewInt(1)}
		randomAccounts = newAccounts(2)
	)
	api := NewBlockChainAPI(newTestBackend(t, genBlocks, genesis, beacon.NewFaker(), func(i int, b *core.BlockGen) {
		// Transfer from account[0] to account[1]
		//    value: 1000 planck
		//    fee:   0 planck
		tx, _ := types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &accounts[1].addr, Value: big.NewInt(1000), Gas: params.TxGas, GasFeeCap: b.BaseFee(), Data: nil}), signer, accounts[0].key)
		b.AddTx(tx)
	}))
	var testSuite = []struct {
		blockNumber rpc.BlockNumber
		call        TransactionArgs
		overrides   StateOverride
		expectErr   error
		want        uint64
	}{
		// simple transfer on latest block
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &accounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: nil,
			want:      21000,
		},
		// simple transfer with insufficient funds on latest block
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &randomAccounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: core.ErrInsufficientFunds,
			want:      21000,
		},
		// empty create
		{
			blockNumber: rpc.LatestBlockNumber,
			call:        TransactionArgs{},
			expectErr:   nil,
			want:        53000,
		},
		{
			blockNumber: rpc.LatestBlockNumber,
			call:        TransactionArgs{},
			overrides: StateOverride{
				randomAccounts[0].addr: OverrideAccount{Balance: newRPCBalance(new(big.Int).Mul(big.NewInt(1), big.NewInt(params.Quanta)))},
			},
			expectErr: nil,
			want:      53000,
		},
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &randomAccounts[0].addr,
				To:    &randomAccounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			overrides: StateOverride{
				randomAccounts[0].addr: OverrideAccount{Balance: newRPCBalance(big.NewInt(0))},
			},
			expectErr: core.ErrInsufficientFunds,
		},
	}
	for i, tc := range testSuite {
		result, err := api.EstimateGas(context.Background(), tc.call, &rpc.BlockNumberOrHash{BlockNumber: &tc.blockNumber}, &tc.overrides)
		if tc.expectErr != nil {
			if err == nil {
				t.Errorf("test %d: want error %v, have nothing", i, tc.expectErr)
				continue
			}
			if !errors.Is(err, tc.expectErr) {
				t.Errorf("test %d: error mismatch, want %v, have %v", i, tc.expectErr, err)
			}
			continue
		}
		if err != nil {
			t.Errorf("test %d: want no error, have %v", i, err)
			continue
		}
		if uint64(result) != tc.want {
			t.Errorf("test %d, result mismatch, have\n%v\n, want\n%v\n", i, uint64(result), tc.want)
		}
	}
}

func TestCall(t *testing.T) {
	t.Parallel()
	// Initialize test accounts
	var (
		accounts = newAccounts(3)
		genesis  = &core.Genesis{
			Config: params.TestChainConfig,
			Alloc: core.GenesisAlloc{
				accounts[0].addr: {Balance: big.NewInt(params.Quanta)},
				accounts[1].addr: {Balance: big.NewInt(params.Quanta)},
				accounts[2].addr: {Balance: big.NewInt(params.Quanta)},
			},
		}
		genBlocks = 10
		signer    = types.ShanghaiSigner{ChainId: big.NewInt(1)}
	)
	api := NewBlockChainAPI(newTestBackend(t, genBlocks, genesis, beacon.NewFaker(), func(i int, b *core.BlockGen) {
		// Transfer from account[0] to account[1]
		//    value: 1000 planck
		//    fee:   0 planck
		tx, _ := types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &accounts[1].addr, Value: big.NewInt(1000), Gas: params.TxGas, GasFeeCap: b.BaseFee(), Data: nil}), signer, accounts[0].key)
		b.AddTx(tx)
	}))
	randomAccounts := newAccounts(3)
	var testSuite = []struct {
		blockNumber    rpc.BlockNumber
		overrides      StateOverride
		call           TransactionArgs
		blockOverrides BlockOverrides
		expectErr      error
		want           string
	}{
		// transfer on genesis
		{
			blockNumber: rpc.BlockNumber(0),
			call: TransactionArgs{
				From:  &accounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: nil,
			want:      "0x",
		},
		// transfer on the head
		{
			blockNumber: rpc.BlockNumber(genBlocks),
			call: TransactionArgs{
				From:  &accounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: nil,
			want:      "0x",
		},
		// transfer on a non-existent block, error expects
		{
			blockNumber: rpc.BlockNumber(genBlocks + 1),
			call: TransactionArgs{
				From:  &accounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: errors.New("header not found"),
		},
		// transfer on the latest block
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &accounts[0].addr,
				To:    &accounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: nil,
			want:      "0x",
		},
		// Call which can only succeed if state is state overridden
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &randomAccounts[0].addr,
				To:    &randomAccounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			overrides: StateOverride{
				randomAccounts[0].addr: OverrideAccount{Balance: newRPCBalance(new(big.Int).Mul(big.NewInt(1), big.NewInt(params.Quanta)))},
			},
			want: "0x",
		},
		// Invalid call without state overriding
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From:  &randomAccounts[0].addr,
				To:    &randomAccounts[1].addr,
				Value: (*hexutil.Big)(big.NewInt(1000)),
			},
			expectErr: core.ErrInsufficientFunds,
		},
		// Successful simple contract call
		//
		// // SPDX-License-Identifier: GPL-3.0
		// // TODO(now.youtrack.cloud/issue/TGZ-30)
		//  pragma hyperion >=0.7.0 <0.8.0;
		//
		//  /**
		//   * @title Storage
		//   * @dev Store & retrieve value in a variable
		//   */
		//  contract Storage {
		//      uint256 public number;
		//      constructor() {
		//          number = block.number;
		//      }
		//  }
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From: &randomAccounts[0].addr,
				To:   &randomAccounts[2].addr,
				Data: hex2Bytes("8381f58a"), // call number()
			},
			overrides: StateOverride{
				randomAccounts[2].addr: OverrideAccount{
					Code:      hex2Bytes("6080604052348015600f57600080fd5b506004361060285760003560e01c80638381f58a14602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000548156fea2646970667358221220eab35ffa6ab2adfe380772a48b8ba78e82a1b820a18fcb6f59aa4efb20a5f60064736f6c63430007040033"),
					StateDiff: &map[common.Hash]common.Hash{{}: common.BigToHash(big.NewInt(123))},
				},
			},
			want: "0x000000000000000000000000000000000000000000000000000000000000007b",
		},
		// Block overrides should work
		{
			blockNumber: rpc.LatestBlockNumber,
			call: TransactionArgs{
				From: &accounts[1].addr,
				Input: &hexutil.Bytes{
					0x43,             // NUMBER
					0x60, 0x00, 0x52, // MSTORE offset 0
					0x60, 0x20, 0x60, 0x00, 0xf3,
				},
			},
			blockOverrides: BlockOverrides{Number: (*hexutil.Big)(big.NewInt(11))},
			want:           "0x000000000000000000000000000000000000000000000000000000000000000b",
		},
	}
	for i, tc := range testSuite {
		result, err := api.Call(context.Background(), tc.call, rpc.BlockNumberOrHash{BlockNumber: &tc.blockNumber}, &tc.overrides, &tc.blockOverrides)
		if tc.expectErr != nil {
			if err == nil {
				t.Errorf("test %d: want error %v, have nothing", i, tc.expectErr)
				continue
			}
			if !errors.Is(err, tc.expectErr) {
				// Second try
				if !reflect.DeepEqual(err, tc.expectErr) {
					t.Errorf("test %d: error mismatch, want %v, have %v", i, tc.expectErr, err)
				}
			}
			continue
		}
		if err != nil {
			t.Errorf("test %d: want no error, have %v", i, err)
			continue
		}
		if !reflect.DeepEqual(result.String(), tc.want) {
			t.Errorf("test %d, result mismatch, have\n%v\n, want\n%v\n", i, result.String(), tc.want)
		}
	}
}

type Account struct {
	key  *walletmldsa87.Wallet
	addr common.Address
}

func newAccounts(n int) (accounts []Account) {
	for i := 0; i < n; i++ {
		key, _ := crypto.GenerateMLDSA87Key()
		addr := key.GetAddress()
		accounts = append(accounts, Account{key: key, addr: addr})
	}
	slices.SortFunc(accounts, func(a, b Account) int { return a.addr.Cmp(b.addr) })
	return accounts
}

func newRPCBalance(balance *big.Int) **hexutil.Big {
	rpcBalance := (*hexutil.Big)(balance)
	return &rpcBalance
}

func hex2Bytes(str string) *hexutil.Bytes {
	rpcBytes := hexutil.Bytes(common.Hex2Bytes(str))
	return &rpcBytes
}

func TestRPCMarshalBlock(t *testing.T) {
	t.Parallel()
	var (
		txs []*types.Transaction
		to  = common.BytesToAddress([]byte{0x11})
	)
	for i := uint64(1); i <= 4; i++ {
		var tx *types.Transaction
		if i%2 == 0 {
			tx = types.NewTx(&types.DynamicFeeTx{
				Nonce:     i,
				GasFeeCap: big.NewInt(11111),
				Gas:       1111,
				To:        &to,
				Value:     big.NewInt(111),
				Data:      []byte{0x11, 0x11, 0x11},
			})
		} else {
			tx = types.NewTx(&types.DynamicFeeTx{
				ChainID:   big.NewInt(1337),
				Nonce:     i,
				GasFeeCap: big.NewInt(11111),
				Gas:       1111,
				To:        &to,
				Value:     big.NewInt(111),
				Data:      []byte{0x11, 0x11, 0x11},
			})
		}
		txs = append(txs, tx)
	}
	block := types.NewBlock(&types.Header{Number: big.NewInt(100)}, &types.Body{Transactions: txs}, nil, blocktest.NewHasher())

	var testSuite = []struct {
		inclTx bool
		fullTx bool
		want   string
	}{
		// without txs
		{
			inclTx: false,
			fullTx: false,
			want: `{
					"extraData": "0x",
					"gasLimit": "0x0",
					"gasUsed": "0x0",
					"hash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
					"logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
					"miner": "Q0000000000000000000000000000000000000000",
					"number": "0x64",
					"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"prevRandao": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"receiptsRoot": "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
					"size": "0x736f",
					"stateRoot": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"timestamp": "0x0",
					"transactionsRoot": "0x5d8b0a744c28c706cbd0c506077b6dfac70c7f5dde72d925a27ffc8ddf4c9ce9"
				}`,
		},

		// only tx hashes
		{
			inclTx: true,
			fullTx: false,
			want: `{
					"extraData": "0x",
					"gasLimit": "0x0",
					"gasUsed": "0x0",
					"hash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
					"logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
					"miner": "Q0000000000000000000000000000000000000000",
					"number": "0x64",
					"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"prevRandao": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"receiptsRoot": "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
					"size": "0x736f",
					"stateRoot": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"timestamp": "0x0",
					"transactions": [
						"0x8539ae615d5568a7c8d2ea4966ddba15895c37f29e83188b9ec577490768d9b6",
						"0xad6497b10335f8599f76d0dd81131beac4ea33d3aee72d53ea870eb6e44b11d6",
						"0x068c72215eb3c2c84fedc06c6323955034dae9d8b7d979ac856756c01f47c142",
						"0x3620a979346eda526a4cb8f9378034bedee1434177005183e482c54e3dacd8fe"
					],
					"transactionsRoot": "0x5d8b0a744c28c706cbd0c506077b6dfac70c7f5dde72d925a27ffc8ddf4c9ce9"
				}`,
		},
		// full tx details
		{
			inclTx: true,
			fullTx: true,
			want: `{
					"extraData": "0x",
					"gasLimit": "0x0",
					"gasUsed": "0x0",
					"hash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
					"logsBloom": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
					"miner": "Q0000000000000000000000000000000000000000",
					"number": "0x64",
					"parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"prevRandao": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"receiptsRoot": "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
					"size": "0x736f",
					"stateRoot": "0x0000000000000000000000000000000000000000000000000000000000000000",
					"timestamp": "0x0",
					"transactions": [
						{
							"blockHash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
							"blockNumber": "0x64",
							"from": "Q0000000000000000000000000000000000000000",
							"gas": "0x457",
							"gasPrice": "0x2b67",
							"maxFeePerGas": "0x2b67",
							"maxPriorityFeePerGas": "0x0",
							"hash": "0x8539ae615d5568a7c8d2ea4966ddba15895c37f29e83188b9ec577490768d9b6",
							"input": "0x111111",
							"nonce": "0x1",
							"to": "Q0000000000000000000000000000000000000011",
							"transactionIndex": "0x0",
							"value": "0x6f",
							"type": "0x2",
							"accessList": [],
							"chainId": "0x539",
							"publicKey": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"signature": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"descriptor": "0x000000"
						},
						{
							"accessList": [],
							"blockHash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
							"blockNumber": "0x64",
							"from": "Q0000000000000000000000000000000000000000",
							"gas": "0x457",
							"gasPrice": "0x2b67",
							"hash": "0xad6497b10335f8599f76d0dd81131beac4ea33d3aee72d53ea870eb6e44b11d6",
							"input": "0x111111",
							"maxFeePerGas": "0x2b67",
							"maxPriorityFeePerGas": "0x0",
							"nonce": "0x2",
							"to": "Q0000000000000000000000000000000000000011",
							"transactionIndex": "0x1",
							"value": "0x6f",
							"type": "0x2",
							"chainId": "0x0",
							"publicKey": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"signature": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"descriptor": "0x000000"
						},
						{
							"blockHash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
							"blockNumber": "0x64",
							"from": "Q0000000000000000000000000000000000000000",
							"gas": "0x457",
							"gasPrice": "0x2b67",
							"maxFeePerGas": "0x2b67",
							"maxPriorityFeePerGas": "0x0",
							"hash": "0x068c72215eb3c2c84fedc06c6323955034dae9d8b7d979ac856756c01f47c142",
							"input": "0x111111",
							"nonce": "0x3",
							"to": "Q0000000000000000000000000000000000000011",
							"transactionIndex": "0x2",
							"value": "0x6f",
							"type": "0x2",
							"accessList": [],
							"chainId": "0x539",
							"publicKey": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"signature": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"descriptor": "0x000000"
						},
						{
							"accessList": [],
							"blockHash": "0x8788f6528b898f38184a4706f7b030e958847229c8250e4cd15b71c25e71ae26",
							"blockNumber": "0x64",
							"from": "Q0000000000000000000000000000000000000000",
							"gas": "0x457",
							"gasPrice": "0x2b67",
							"hash": "0x3620a979346eda526a4cb8f9378034bedee1434177005183e482c54e3dacd8fe",
							"input": "0x111111",
							"maxFeePerGas": "0x2b67",
							"maxPriorityFeePerGas": "0x0",
							"nonce": "0x4",
							"to": "Q0000000000000000000000000000000000000011",
							"transactionIndex": "0x3",
							"value": "0x6f",
							"type": "0x2",
							"chainId": "0x0",
							"publicKey": "0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"signature": "0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
							"descriptor": "0x000000"
						}
					],
					"transactionsRoot": "0x5d8b0a744c28c706cbd0c506077b6dfac70c7f5dde72d925a27ffc8ddf4c9ce9"
				}`,
		},
	}

	for i, tc := range testSuite {
		resp := RPCMarshalBlock(block, tc.inclTx, tc.fullTx, params.MainnetChainConfig)
		out, err := json.Marshal(resp)
		if err != nil {
			t.Errorf("test %d: json marshal error: %v", i, err)
			continue
		}
		require.JSONEqf(t, tc.want, string(out), "test %d", i)
	}
}

func TestRPCGetBlockOrHeader(t *testing.T) {
	t.Parallel()

	// Initialize test accounts
	var (
		acc1Key, _                = pqcrypto.HexToWallet("8a1f9a8f95be41cd7ccb6168179afb4504aefe388d1e14474d32c45c72ce7b7a")
		acc2Key, _                = pqcrypto.HexToWallet("49a7b37aa6f6645917e7b807e9d1c00d4fa71f18343b0d4122a4d2df64dd6fee")
		acc1Addr                  = acc1Key.GetAddress()
		acc2Addr   common.Address = acc2Key.GetAddress()
		genesis                   = &core.Genesis{
			Config: params.TestChainConfig,
			Alloc: core.GenesisAlloc{
				acc1Addr: {Balance: big.NewInt(params.Quanta)},
				acc2Addr: {Balance: big.NewInt(params.Quanta)},
			},
		}
		genBlocks = 10
		signer    = types.ShanghaiSigner{ChainId: big.NewInt(1)}
		tx        = types.NewTx(&types.DynamicFeeTx{
			Nonce:     11,
			GasFeeCap: big.NewInt(11111),
			Gas:       1111,
			To:        &acc2Addr,
			Value:     big.NewInt(111),
			Data:      []byte{0x11, 0x11, 0x11},
		})
		withdrawal = &types.Withdrawal{
			Index:     0,
			Validator: 1,
			Address:   common.Address{0x12, 0x34},
			Amount:    10,
		}
		pending = types.NewBlock(&types.Header{Number: big.NewInt(11), Time: 42}, &types.Body{Transactions: types.Transactions{tx}, Withdrawals: types.Withdrawals{withdrawal}}, nil, blocktest.NewHasher())
	)
	backend := newTestBackend(t, genBlocks, genesis, beacon.NewFaker(), func(i int, b *core.BlockGen) {
		// Transfer from account[0] to account[1]
		//    value: 1000 planck
		//    fee:   0 planck
		tx, _ := types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &acc2Addr, Value: big.NewInt(1000), Gas: params.TxGas, GasFeeCap: b.BaseFee(), Data: nil}), signer, acc1Key)
		b.AddTx(tx)
	})
	backend.setPendingBlock(pending)
	api := NewBlockChainAPI(backend)
	blockHashes := make([]common.Hash, genBlocks+1)
	ctx := context.Background()
	for i := 0; i <= genBlocks; i++ {
		header, err := backend.HeaderByNumber(ctx, rpc.BlockNumber(i))
		if err != nil {
			t.Errorf("failed to get block: %d err: %v", i, err)
		}
		blockHashes[i] = header.Hash()
	}
	pendingHash := pending.Hash()

	var testSuite = []struct {
		blockNumber rpc.BlockNumber
		blockHash   *common.Hash
		fullTx      bool
		reqHeader   bool
		file        string
		expectErr   error
	}{
		// 0. latest header
		{
			blockNumber: rpc.LatestBlockNumber,
			reqHeader:   true,
			file:        "tag-latest",
		},
		// 1. genesis header
		{
			blockNumber: rpc.BlockNumber(0),
			reqHeader:   true,
			file:        "number-0",
		},
		// 2. #1 header
		{
			blockNumber: rpc.BlockNumber(1),
			reqHeader:   true,
			file:        "number-1",
		},
		// 3. latest-1 header
		{
			blockNumber: rpc.BlockNumber(9),
			reqHeader:   true,
			file:        "number-latest-1",
		},
		// 4. latest+1 header
		{
			blockNumber: rpc.BlockNumber(11),
			reqHeader:   true,
			file:        "number-latest+1",
		},
		// 5. pending header
		{
			blockNumber: rpc.PendingBlockNumber,
			reqHeader:   true,
			file:        "tag-pending",
		},
		// 6. latest block
		{
			blockNumber: rpc.LatestBlockNumber,
			file:        "tag-latest",
		},
		// 7. genesis block
		{
			blockNumber: rpc.BlockNumber(0),
			file:        "number-0",
		},
		// 8. #1 block
		{
			blockNumber: rpc.BlockNumber(1),
			file:        "number-1",
		},
		// 9. latest-1 block
		{
			blockNumber: rpc.BlockNumber(9),
			fullTx:      true,
			file:        "number-latest-1",
		},
		// 10. latest+1 block
		{
			blockNumber: rpc.BlockNumber(11),
			fullTx:      true,
			file:        "number-latest+1",
		},
		// 11. pending block
		{
			blockNumber: rpc.PendingBlockNumber,
			file:        "tag-pending",
		},
		// 12. pending block + fullTx
		{
			blockNumber: rpc.PendingBlockNumber,
			fullTx:      true,
			file:        "tag-pending-fullTx",
		},
		// 13. latest header by hash
		{
			blockHash: &blockHashes[len(blockHashes)-1],
			reqHeader: true,
			file:      "hash-latest",
		},
		// 14. genesis header by hash
		{
			blockHash: &blockHashes[0],
			reqHeader: true,
			file:      "hash-0",
		},
		// 15. #1 header
		{
			blockHash: &blockHashes[1],
			reqHeader: true,
			file:      "hash-1",
		},
		// 16. latest-1 header
		{
			blockHash: &blockHashes[len(blockHashes)-2],
			reqHeader: true,
			file:      "hash-latest-1",
		},
		// 17. empty hash
		{
			blockHash: &common.Hash{},
			reqHeader: true,
			file:      "hash-empty",
		},
		// 18. pending hash
		{
			blockHash: &pendingHash,
			reqHeader: true,
			file:      `hash-pending`,
		},
		// 19. latest block
		{
			blockHash: &blockHashes[len(blockHashes)-1],
			file:      "hash-latest",
		},
		// 20. genesis block
		{
			blockHash: &blockHashes[0],
			file:      "hash-genesis",
		},
		// 21. #1 block
		{
			blockHash: &blockHashes[1],
			file:      "hash-1",
		},
		// 22. latest-1 block
		{
			blockHash: &blockHashes[len(blockHashes)-2],
			fullTx:    true,
			file:      "hash-latest-1-fullTx",
		},
		// 23. empty hash + body
		{
			blockHash: &common.Hash{},
			fullTx:    true,
			file:      "hash-empty-fullTx",
		},
		// 24. pending block
		{
			blockHash: &pendingHash,
			file:      `hash-pending`,
		},
		// 25. pending block + fullTx
		{
			blockHash: &pendingHash,
			fullTx:    true,
			file:      "hash-pending-fullTx",
		},
	}

	for i, tt := range testSuite {
		var (
			result map[string]interface{}
			err    error
			rpc    string
		)
		if tt.blockHash != nil {
			if tt.reqHeader {
				result = api.GetHeaderByHash(context.Background(), *tt.blockHash)
				rpc = "qrl_getHeaderByHash"
			} else {
				result, err = api.GetBlockByHash(context.Background(), *tt.blockHash, tt.fullTx)
				rpc = "qrl_getBlockByHash"
			}
		} else {
			if tt.reqHeader {
				result, err = api.GetHeaderByNumber(context.Background(), tt.blockNumber)
				rpc = "qrl_getHeaderByNumber"
			} else {
				result, err = api.GetBlockByNumber(context.Background(), tt.blockNumber, tt.fullTx)
				rpc = "qrl_getBlockByNumber"
			}
		}
		if tt.expectErr != nil {
			if err == nil {
				t.Errorf("test %d: want error %v, have nothing", i, tt.expectErr)
				continue
			}
			if !errors.Is(err, tt.expectErr) {
				t.Errorf("test %d: error mismatch, want %v, have %v", i, tt.expectErr, err)
			}
			continue
		}
		if err != nil {
			t.Errorf("test %d: want no error, have %v", i, err)
			continue
		}

		testRPCResponseWithFile(t, i, result, rpc, tt.file)
	}
}

func setupReceiptBackend(t *testing.T, genBlocks int) (*testBackend, []common.Hash) {
	config := *params.TestChainConfig
	var (
		acc1Key, _                 = pqcrypto.HexToWallet("8a1f9a8f95be41cd7ccb6168179afb4504aefe388d1e14474d32c45c72ce7b7a")
		acc2Key, _                 = pqcrypto.HexToWallet("49a7b37aa6f6645917e7b807e9d1c00d4fa71f18343b0d4122a4d2df64dd6fee")
		acc1Addr                   = acc1Key.GetAddress()
		acc2Addr    common.Address = acc2Key.GetAddress()
		contract, _                = common.NewAddressFromString("Q0000000000000000000000000000000000031ec7")
		genesis                    = &core.Genesis{
			Config: &config,
			Alloc: core.GenesisAlloc{
				acc1Addr: {Balance: big.NewInt(params.Quanta)},
				acc2Addr: {Balance: big.NewInt(params.Quanta)},
				// // SPDX-License-Identifier: GPL-3.0
				// // TODO(now.youtrack.cloud/issue/TGZ-30)
				// pragma hyperion >=0.7.0 <0.9.0;
				//
				// contract Token {
				//     event Transfer(address indexed from, address indexed to, uint256 value);
				//     function transfer(address to, uint256 value) public returns (bool) {
				//         emit Transfer(msg.sender, to, value);
				//         return true;
				//     }
				// }
				contract: {Balance: big.NewInt(params.Quanta), Code: common.FromHex("0x608060405234801561001057600080fd5b506004361061002b5760003560e01c8063a9059cbb14610030575b600080fd5b61004a6004803603810190610045919061016a565b610060565b60405161005791906101c5565b60405180910390f35b60008273ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef846040516100bf91906101ef565b60405180910390a36001905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000610101826100d6565b9050919050565b610111816100f6565b811461011c57600080fd5b50565b60008135905061012e81610108565b92915050565b6000819050919050565b61014781610134565b811461015257600080fd5b50565b6000813590506101648161013e565b92915050565b60008060408385031215610181576101806100d1565b5b600061018f8582860161011f565b92505060206101a085828601610155565b9150509250929050565b60008115159050919050565b6101bf816101aa565b82525050565b60006020820190506101da60008301846101b6565b92915050565b6101e981610134565b82525050565b600060208201905061020460008301846101e0565b9291505056fea2646970667358221220b469033f4b77b9565ee84e0a2f04d496b18160d26034d54f9487e57788fd36d564736f6c63430008120033")},
			},
		}
		signer   = types.LatestSignerForChainID(params.TestChainConfig.ChainID)
		txHashes = make([]common.Hash, genBlocks)
	)

	backend := newTestBackend(t, genBlocks, genesis, beacon.New(), func(i int, b *core.BlockGen) {
		var (
			tx  *types.Transaction
			err error
		)
		switch i {
		case 0:
			// transfer 1000planck
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &acc2Addr, Value: big.NewInt(1000), Gas: params.TxGas, GasFeeCap: b.BaseFee(), Data: nil}), types.ShanghaiSigner{ChainId: big.NewInt(1)}, acc1Key)
		case 1:
			// create contract
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: nil, Gas: 53100, GasFeeCap: b.BaseFee(), Data: common.FromHex("0x60806040")}), signer, acc1Key)
		case 2:
			// with logs
			// transfer(address to, uint256 value)
			data := fmt.Sprintf("0xa9059cbb%s%s", common.HexToHash(common.BigToHash(big.NewInt(int64(i + 1))).Hex()).String()[2:], common.BytesToHash([]byte{byte(i + 11)}).String()[2:])
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &contract, Gas: 60000, GasFeeCap: b.BaseFee(), Data: common.FromHex(data)}), signer, acc1Key)
		case 3:
			// dynamic fee with logs
			// transfer(address to, uint256 value)
			data := fmt.Sprintf("0xa9059cbb%s%s", common.HexToHash(common.BigToHash(big.NewInt(int64(i + 1))).Hex()).String()[2:], common.BytesToHash([]byte{byte(i + 11)}).String()[2:])
			fee := big.NewInt(500)
			fee.Add(fee, b.BaseFee())
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: &contract, Gas: 60000, Value: big.NewInt(1), GasTipCap: big.NewInt(500), GasFeeCap: fee, Data: common.FromHex(data)}), signer, acc1Key)
		case 4:
			// access list with contract create
			accessList := types.AccessList{{
				Address:     contract,
				StorageKeys: []common.Hash{{0}},
			}}
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{Nonce: uint64(i), To: nil, Gas: 58100, GasFeeCap: b.BaseFee(), Data: common.FromHex("0x60806040"), AccessList: accessList}), signer, acc1Key)
		case 5:
			// dynamic fee tx
			fee := big.NewInt(500)
			fee.Add(fee, b.BaseFee())
			tx, err = types.SignTx(types.NewTx(&types.DynamicFeeTx{
				Nonce:     uint64(i),
				GasTipCap: big.NewInt(1),
				GasFeeCap: fee,
				Gas:       params.TxGas,
				To:        &acc2Addr,
				Value:     big.NewInt(0),
			}), signer, acc1Key)
		}
		if err != nil {
			t.Errorf("failed to sign tx: %v", err)
		}
		if tx != nil {
			b.AddTx(tx)
			txHashes[i] = tx.Hash()
		}
	})
	return backend, txHashes
}

func TestRPCGetTransactionReceipt(t *testing.T) {
	t.Parallel()

	var (
		backend, txHashes = setupReceiptBackend(t, 6)
		api               = NewTransactionAPI(backend, new(AddrLocker))
	)

	var testSuite = []struct {
		txHash common.Hash
		file   string
	}{
		// 0. normal success
		{
			txHash: txHashes[0],
			file:   "normal-transfer-tx",
		},
		// 1. create contract
		{
			txHash: txHashes[1],
			file:   "create-contract-tx",
		},
		// 2. with logs success
		{
			txHash: txHashes[2],
			file:   "with-logs",
		},
		// 3. dynamic tx with logs success
		{
			txHash: txHashes[3],
			file:   `dynamic-tx-with-logs`,
		},
		// 4. access list tx with create contract
		{
			txHash: txHashes[4],
			file:   "create-contract-with-access-list",
		},
		// 5. txhash empty
		{
			txHash: common.Hash{},
			file:   "txhash-empty",
		},
		// 6. txhash not found
		{
			txHash: common.HexToHash("deadbeef"),
			file:   "txhash-notfound",
		},
	}

	for i, tt := range testSuite {
		var (
			result interface{}
			err    error
		)
		result, err = api.GetTransactionReceipt(context.Background(), tt.txHash)
		if err != nil {
			t.Errorf("test %d: want no error, have %v", i, err)
			continue
		}
		testRPCResponseWithFile(t, i, result, "qrl_getTransactionReceipt", tt.file)
	}
}

func TestRPCGetBlockReceipts(t *testing.T) {
	t.Parallel()

	var (
		genBlocks  = 6
		backend, _ = setupReceiptBackend(t, genBlocks)
		api        = NewBlockChainAPI(backend)
	)
	blockHashes := make([]common.Hash, genBlocks+1)
	ctx := context.Background()
	for i := 0; i <= genBlocks; i++ {
		header, err := backend.HeaderByNumber(ctx, rpc.BlockNumber(i))
		if err != nil {
			t.Errorf("failed to get block: %d err: %v", i, err)
		}
		blockHashes[i] = header.Hash()
	}

	var testSuite = []struct {
		test rpc.BlockNumberOrHash
		file string
	}{
		// 0. block without any txs(hash)
		{
			test: rpc.BlockNumberOrHashWithHash(blockHashes[0], false),
			file: "number-0",
		},
		// 1. block without any txs(number)
		{
			test: rpc.BlockNumberOrHashWithNumber(0),
			file: "number-1",
		},
		// 2. earliest tag
		{
			test: rpc.BlockNumberOrHashWithNumber(rpc.EarliestBlockNumber),
			file: "tag-earliest",
		},
		// 3. latest tag
		{
			test: rpc.BlockNumberOrHashWithNumber(rpc.LatestBlockNumber),
			file: "tag-latest",
		},
		// 4. block with transfer tx(hash)
		{
			test: rpc.BlockNumberOrHashWithHash(blockHashes[1], false),
			file: "block-with-transfer-tx",
		},
		// 5. block with contract create tx(number)
		{
			test: rpc.BlockNumberOrHashWithNumber(rpc.BlockNumber(2)),
			file: "block-with-contract-create-tx",
		},
		// 6. block with contract call tx(hash)
		{
			test: rpc.BlockNumberOrHashWithHash(blockHashes[3], false),
			file: "block-with-contract-call-tx",
		},
		// 7. block with dynamic fee tx(number)
		{
			test: rpc.BlockNumberOrHashWithNumber(rpc.BlockNumber(4)),
			file: "block-with-dynamic-fee-tx",
		},
		// 8. block is empty
		{
			test: rpc.BlockNumberOrHashWithHash(common.Hash{}, false),
			file: "hash-empty",
		},
		// 9. block is not found
		{
			test: rpc.BlockNumberOrHashWithHash(common.HexToHash("deadbeef"), false),
			file: "hash-notfound",
		},
		// 10. block is not found
		{
			test: rpc.BlockNumberOrHashWithNumber(rpc.BlockNumber(genBlocks + 1)),
			file: "block-notfound",
		},
	}

	for i, tt := range testSuite {
		var (
			result interface{}
			err    error
		)
		result, err = api.GetBlockReceipts(context.Background(), tt.test)
		if err != nil {
			t.Errorf("test %d: want no error, have %v", i, err)
			continue
		}
		testRPCResponseWithFile(t, i, result, "qrl_getBlockReceipts", tt.file)
	}
}

func testRPCResponseWithFile(t *testing.T, testid int, result interface{}, rpc string, file string) {
	data, err := json.MarshalIndent(result, "", "  ")
	if err != nil {
		t.Errorf("test %d: json marshal error", testid)
		return
	}
	outputFile := filepath.Join("testdata", fmt.Sprintf("%s-%s.json", rpc, file))
	if os.Getenv("WRITE_TEST_FILES") != "" {
		os.WriteFile(outputFile, data, 0644)
	}
	want, err := os.ReadFile(outputFile)
	if err != nil {
		t.Fatalf("error reading expected test file: %s output: %v", outputFile, err)
	}
	require.JSONEqf(t, string(want), string(data), "test %d: json not match, want: %s, have: %s", testid, string(want), string(data))
}
